name: ‚úÖ Test
on:
  push:
    branches: ['*']
  pull_request:

jobs:
  build:
    strategy:
      matrix:
        include:
          - { version: 17 }

    name: üêò PostgreSQL ${{ matrix.version }}
    runs-on: ubuntu-latest
    container: rodoq/postgres-pgtap
    env:
      PGUSER: postgres
    steps:
      - run: pg-start ${{ matrix.version }}
      - uses: actions/checkout@v4

      # Basic regression test.
      - run: pg-build-test

      # Test all, install, test, test-serial, and test-parallel, both from clean
      # repo and repeated with existing build, with and without PARALLEL_CONN=1.
      - run: make uninstall clean all
      - run: make all
      - run: make uninstall clean install
      - run: make install
      - run: psql -Ec 'CREATE EXTENSION pgtap'
      - run: make uninstall clean test
      - run: make test
